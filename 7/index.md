# 12. 물리적 저장 장치 시스템


# 12.6 디스크 블록 접근

대부분의 디스크 IO를 담당하는 질의 처리 서브시스템과 함께, DB 시스템이 디스크 IO 요청을 생성한다.
각 요청은 디스크의 식별자 + 논리 블럭 번호로 구성된다.
DB가 OS 파일에 저장되면 IO 요청은 파일 식별자+파일내 블록 번호로 구성된다.
OS는 DB를 위해 디스크-메모리 사이 데이터 전송을 담당한다.



디스크 블록에 대한 요청을 두 가지로 분류한다.   
순차적 접근 유형(sequential access) - 연속적인 요청은 같은 트랙 or 인접 트랙의 연속적 블럭을 대상으로 함   
임의 접근 유형(random access) - 연속적인 요청은 디스크 상 임의 위치한 블록을 대상으로 함. 각 요청은 탐색이 필요하여 접근 시간이 길어지고, 초당 IO 연산 수가 줄어듦.
<br><br>
접근 횟수(특히 임의 접근)를 최소화 하기 위한 여러 기법이 개발되었다.
그리고 이는 자기 디스크에 저장된 데이터의 경우, 성능에 매우 중요하다.(SSD도 영향은 적으나, 일부 기법은 SSD에서도 그대로 이득을 가져다 줃나)

- 버퍼링(Buffering): 다음 요청을 위해 디스크로부터 읽는 블록을 메모리 버퍼에 임시로 저장하는 기법. DB와 OS 모두에서 잘 동작
- 미리 읽기(Read-ahead): 디스크 블록에 접근 시, 블록에 요청이 없어도 동일 트랙 내 연속적 블록을 일단 메모리 버퍼 내로 읽음. 순차적 접근에서, 미리 읽기는 매우 효과적(미리읽기로 읽어온 데이터를 계속 요청하게될 것이므로)
- 스케줄링(Scheduling): 하드디스크에는 위치별로 블록이 저장되어있을 것이다. 여러 블럭을 읽어야 한다면, 어떤 경로로 디스크 암이 이동하면서 읽어야 가장 효율적인지를 판단하여, 해당 경로로 움직인다. 이를 "디스크 암 스케줄링"이라 부른다. "승강기 알고리즘"을 사용한다.(여러 층에서 엘리베이터 버튼을 누르면, 엘리베이터가 최적의 경로를 택하는 방식과 같다고 한다)
- 파일 구성(File organization): 블록 접근 시간을 줄이기 위해, 데이터에 접근하는 방식에 가장 어울리도록 디스크의 블록을 조직하는 것이다. 예를 들어, 한 파일에 연속적인 접근이 있을 것을 원한다면, 그 파일의 모든 블록을 인접하게 저장하는 편이 좋을 것이다.
- 비휘발성 쓰기 버퍼(Nonvolatile write buffer): 메인 메모리는 정전되면 잃어버린다. 따라서 충돌에도 버티려면 DB 갱신과 관한 정보는 디스크에 기록되어야한다. 따라서, 트랜잭션 처리 등 갱신과 관련된 DB 응용 프로그램 성능은 쓰기 속도에 달려 있다.
NVRAM(non-volatile random-access memory)를 쓰면, 쓰기 속도를 높일 수 있다. 쓰기 요청이 들어오면, RVRAM에 쓴다음, 쓰기 요청이 완료되었음을 운영 체제에 알리는 것이다. 더 빠른 시간 내에 쓰기가 완료된다. 그 다음에 NVRAM에 있는 것을 디스크에 쓰면 된다.
